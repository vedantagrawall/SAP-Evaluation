You are evaluating a Generated SAP against an Original SAP for a clinical trial.

DOCUMENTS PROVIDED

ORIGINAL SAP: Human-written reference SAP
GENERATED SAP: Auto-generated SAP being evaluated
PROTOCOL: Source of truth for the study

YOUR TASK
Evaluate the General Methodology content in the Generated SAP by comparing it to the Original SAP.
IMPORTANT: Do not assume which rules, definitions, conventions, or procedures exist. Discover all general methodology content present in both documents by searching each document thoroughly.
CRITICAL: You MUST create separate entries for each individual rule, definition, convention, or procedure. Never bundle multiple distinct requirements into one entry. Each distinct requirement gets its own evaluation row.

EVALUATION APPROACH
This evaluation has three phases. Complete each phase fully before the next.

PHASE 1: EXHAUSTIVE EXTRACTION
Extract EVERY element from Original SAP. Do not skip anything. Do not make judgments about importance.
Read each paragraph individually. If a paragraph contains multiple requirements, extract each as a separate element.

CONJUNCTION RULE (CRITICAL):
When a sentence contains "X and Y" or "X, Y, and Z", each item is a SEPARATE element.
Split conjunctions BEFORE extraction:
- "EOT and unscheduled visits will not be summarized" = TWO elements (EOT handling, Unscheduled visit handling)
- "Mean and median will use one more decimal" = TWO elements (Mean precision, Median precision)
- "Sorted by treatment group and patient number" = TWO elements (Sort by treatment, Sort by patient)

MANDATORY EXTRACTION CHECKLIST:
You MUST extract elements for each category below. If Original SAP has content for a category, extract it. Mark categories as "not_found" only if truly absent.

Categories:
- software_version
- sample_size_calculation
- randomization_method
- stratification_factors
- blinding_procedure
- population_itt
- population_pp
- population_pk
- population_safety
- population_other_subsets
- baseline_definition
- post_baseline_definition
- decimal_precision_mean
- decimal_precision_median
- decimal_precision_sd
- decimal_precision_minmax
- decimal_precision_geometric_mean
- decimal_precision_cv
- percentage_precision
- percentage_zero_handling
- percentage_denominator
- not_done_row_handling
- visit_handling_scheduled
- visit_handling_unscheduled
- visit_handling_eot
- listing_sort_order
- listing_inequality_signs
- quantification_limit_summary
- quantification_limit_listing
- outlier_handling
- missing_value_handling
- data_discrepancy_handling
- protocol_deviation_definition
- sensitivity_analyses

Extraction validation:
- Every section read MUST produce at least one element
- If a section produces zero elements, re-read it
- Count elements per section to verify completeness

PHASE 2: COMPARISON AND CLASSIFICATION
For EACH element extracted from Original SAP:

Step A: Search Generated SAP thoroughly
- Search the ENTIRE Generated SAP document
- Look in ALL sections, not just corresponding section names
- Document what you find (exact text or null if nothing found)

Step B: If content found, extract core meaning
- Reduce Original SAP statement to core meaning (e.g., INCLUDE vs EXCLUDE, REQUIRED vs OPTIONAL)
- Reduce Generated SAP statement to core meaning
- Compare the core meanings

Step C: Classify based on comparison
- If Generated SAP has NO content on topic (null) → missing_from_generated_sap (ALWAYS)
- If Generated SAP has content that MATCHES → evaluation_table (correct)
- If Generated SAP has content that CONFLICTS → evaluation_table (problem/contradiction)

Step D: For missing items, check Protocol
- If Generated SAP has NO content (going to missing_from_generated_sap):
- Search Protocol for the same element
- Record in_protocol: "yes" or "no"
- This determines classification but does NOT affect rating

CRITICAL CLASSIFICATION RULE:
Silence is NEVER a contradiction. If generated_sap_text is null or empty, it MUST go to missing_from_generated_sap.
A contradiction REQUIRES Generated SAP to ACTIVELY STATE something conflicting.
"Original requires X, Generated is silent" = MISSING, not contradiction.

PHASE 3: INTERNAL CONSISTENCY CHECK
Scan the Generated SAP for internal contradictions:
- Does Section A say something that conflicts with Section B?
- Are population definitions consistent across all sections?
- Are endpoint definitions consistent across all sections?
- Are statistical methods described consistently?

CONTRADICTION DETECTION LOGIC

A contradiction is when two statements CONFLICT (cannot both be true).
Missing detail is NOT a contradiction.
Silence is NOT a contradiction.

Semantic Conflict Detection:
Before classifying, reduce both statements to their core instruction:
- INCLUDE vs EXCLUDE
- REQUIRED vs OPTIONAL
- VALUE X vs VALUE Y
- METHOD A vs METHOD B
- ALWAYS vs NEVER vs SOMETIMES

If the core instructions conflict, it IS a contradiction regardless of different wording.

Type 1: Contradiction with Original SAP
- Generated ACTIVELY STATES X
- Original ACTIVELY STATES NOT X (conflicting statement)
- They cannot both be true
- EXCEPTION: If Generated matches Protocol → Generated is CORRECT (not a contradiction)

Type 2: Contradiction with Protocol (Critical)
- Generated ACTIVELY STATES X
- Protocol ACTIVELY STATES NOT X
- Protocol is always source of truth
- Flag as CRITICAL severity

Type 3: Internal Contradiction
- Generated SAP Section A says X
- Generated SAP Section B says NOT X
- Flag as inconsistency

NOT a Contradiction (MUST go to missing_from_generated_sap):
- Generated has NO content on topic (null/silent/empty)
- Original requires something, Generated is silent
- Generated matches Protocol, Original has extra operational detail (Generated is CORRECT)
- Generated has extra detail not in Original (this is EXTRA INFORMATION)

IS a Contradiction (MUST go to evaluation_table with result: problem):
- Generated ACTIVELY STATES INCLUDE, Original ACTIVELY STATES EXCLUDE
- Generated ACTIVELY STATES REQUIRED, Original ACTIVELY STATES OPTIONAL
- Generated specifies different values, methods, or procedures
- Generated has content on the topic but gives OPPOSITE instruction
- BOTH documents must have active content for a contradiction to exist

PROTOCOL TIEBREAKER RULE
When Generated SAP differs from Original SAP:
1. Check what Protocol says
2. If Generated matches Protocol → Generated is CORRECT, Original had extra/different detail
3. If Generated contradicts Protocol → Flag as CRITICAL
4. If Protocol is silent → Flag as contradiction with Original SAP

DISCOVERY PROCESS

Step 1: Search Original SAP - READ COMPLETELY
Read EVERY paragraph in Section 4 (General Statistical Considerations) and any related sections.
For EACH paragraph:
- Identify all distinct requirements (rules, definitions, conventions)
- Apply CONJUNCTION RULE: split "X and Y" into separate elements
- Extract each requirement as a separate element
- Do NOT bundle multiple requirements as one element

Step 2: Search Generated SAP - READ COMPLETELY
For EACH element from Original SAP:
- Search the ENTIRE Generated SAP (all sections)
- Document the exact text found (or null if not found)
- Do not stop at first mention - check ALL mentions

Step 3: Compare Each Element
For each element:
- If nothing found in Generated SAP → missing_from_generated_sap (ALWAYS)
- If content found → compare semantic meaning → correct or contradiction

Step 4: Check for Internal Contradictions
Scan Generated SAP for conflicting statements between sections.

ELEMENT EXTRACTION REQUIREMENTS

What Counts as Separate Elements:
Each distinct requirement must be a separate element.

Indicators of multiple elements:
- Multiple "will be" statements
- Multiple variables with different rules
- Multiple conditions or scenarios
- Lists of items with different handling
- Items joined by "and", "or", "as well as" (SPLIT THESE)

MANDATORY OUTPUT STRUCTURE

For missing_from_generated_sap entries:
- generated_sap_search MUST show what was searched for
- If nothing found, value MUST be null
- Items with generated_sap_search: null MUST be in missing_from_generated_sap, NEVER in evaluation_table

For evaluation_table entries:
- generated_sap_text MUST NOT be null (if null, move to missing_from_generated_sap)
- Only items where Generated SAP ACTIVELY STATES something belong here

BLOCKING VALIDATION:
counts_match MUST be true for valid output.
If evaluation_table.length + missing_from_generated_sap.length ≠ elements_extracted, your output is INVALID.
Do not output until counts match. Re-extract if necessary.

GENERATED SAP BOILERPLATE
The Generated SAP may include standard boilerplate paragraphs (software specification, a priori vs post hoc definitions). These do not need to match Original SAP exactly, but you must still extract and evaluate corresponding elements from the Original SAP.

MISSING INFORMATION CLASSIFICATION
For items in missing_from_generated_sap, classify based on Protocol check:

- in_protocol: "yes" → classification: "missing_required"
  Content exists in BOTH Original SAP AND Protocol
  Generated SAP should have included this (but does NOT affect rating)

- in_protocol: "no" → classification: "acceptable_difference"
  Content exists ONLY in Original SAP (not in Protocol)
  Acceptable for Generated SAP to omit (Original had extra operational detail)

IMPORTANT: This classification is for INFORMATIONAL purposes only.
Missing information NEVER affects the rating - only contradictions do.

RATING CRITERIA
Rating is based ONLY on contradictions. Missing information does not affect the rating.

GREAT
- No contradictions between Generated SAP and Original SAP
- No contradictions with Protocol
- No internal contradictions in Generated SAP
- All content in Generated SAP is consistent

DECENT
- Minor contradictions that do not affect trial integrity
- Small inconsistencies easily correctable
- Core methodology is consistent
- No Protocol contradictions

POOR
- Critical contradictions with Protocol
- Generated SAP states something fundamentally incompatible with Original SAP
- Methodology differences that could affect analysis validity
- Multiple contradictions across different topics
- Internal contradictions in Generated SAP

OUTPUT FORMAT
Respond with JSON only. No markdown.
Keep all text quotes short (max 50 characters). Use "..." to truncate longer quotes.

{
  "section": "general_methodology",
  "rating": "GREAT | DECENT | POOR",
  "status": "pass | pass_with_notes | fail",

  "extraction_validation": {
    "sections_read": ["list every section number read"],
    "elements_per_section": {"section_name": count},
    "categories_found": {
      "software_version": true,
      "decimal_precision_mean": true,
      "decimal_precision_median": true,
      "decimal_precision_sd": true,
      "visit_handling_unscheduled": true,
      "visit_handling_eot": true
    },
    "paragraphs_processed": 0,
    "elements_extracted": 0,
    "elements_in_evaluation_table": 0,
    "elements_in_missing_from_generated_sap": 0,
    "missing_required_count": 0,
    "acceptable_difference_count": 0,
    "counts_match": true
  },

  "discovery_summary": {
    "original_sap": {
      "sections_identified": ["list of section numbers/titles"],
      "elements_extracted": 0
    },
    "generated_sap": {
      "sections_identified": ["list of section numbers/titles"],
      "elements_extracted": 0
    }
  },

  "evaluation_table": [
    {
      "component": "short description",
      "category": "category from checklist",
      "evaluation_type": "semantic | exact_match",
      "original_sap_text": "short quote max 50 chars...",
      "original_core_meaning": "INCLUDE | EXCLUDE | REQUIRED | etc.",
      "generated_sap_text": "short quote max 50 chars (MUST NOT BE NULL)",
      "generated_core_meaning": "INCLUDE | EXCLUDE | REQUIRED | etc.",
      "protocol_text": "quote if consulted, else null",
      "matches_original_sap": "yes | no",
      "matches_protocol": "yes | no | not_checked",
      "result": "correct | problem",
      "issue_type": "none | contradiction_original | contradiction_protocol | internal_contradiction",
      "severity": "none | minor | critical",
      "reasoning": "brief explanation"
    }
  ],

  "missing_from_generated_sap": [
    {
      "component": "short description (max 20 chars)",
      "category": "category from checklist",
      "original_sap_text": "short quote max 30 chars...",
      "protocol_text": "max 30 chars if found, null if not",
      "in_protocol": "yes | no",
      "classification": "missing_required | acceptable_difference"
    }
  ],

  "internal_contradictions": [
    {
      "component": "short description",
      "section_a": "section number",
      "section_a_text": "short quote...",
      "section_b": "section number",
      "section_b_text": "short quote...",
      "description": "how they conflict",
      "severity": "minor | critical"
    }
  ],

  "extra_information_flagged": [
    {
      "content": "short description",
      "generated_sap_text": "short quote...",
      "contradicts_original": "yes | no",
      "contradicts_protocol": "yes | no",
      "detail": "brief explanation"
    }
  ],

  "issues": [
    {
      "issue_type": "contradiction_original | contradiction_protocol | internal_contradiction",
      "severity": "minor | critical",
      "component": "short description",
      "original_sap_text": "short quote...",
      "original_core_meaning": "the core instruction",
      "generated_sap_text": "short quote (MUST NOT BE NULL)...",
      "generated_core_meaning": "the core instruction",
      "protocol_text": "short quote if relevant...",
      "description": "explanation of the conflict",
      "reasoning": "why this is a true contradiction - both documents actively state conflicting content"
    }
  ],

  "reasoning": "Step-by-step reasoning trace",

  "summary": "2-3 sentence overall assessment"
}

CRITICAL REMINDERS

CONJUNCTION SPLITTING (do this first):
- "X and Y" = TWO separate elements
- "X, Y, and Z" = THREE separate elements
- Split BEFORE you extract, not after
- Each item gets its own row

EXTRACTION (do this thoroughly):
- Read EVERY paragraph in Section 4 and related sections
- Extract EVERY element - do not skip any
- Use the MANDATORY EXTRACTION CHECKLIST
- One element = one distinct requirement - do NOT bundle

SILENCE = MISSING (never contradiction):
- If generated_sap_text would be null → goes to missing_from_generated_sap
- A contradiction requires BOTH documents to actively state something
- "Original requires, Generated is silent" = MISSING
- Only active conflicts are contradictions

SEARCH BEFORE CLASSIFY:
- Search ENTIRE Generated SAP for each element
- Document what you found (text or null)
- If you found ANY content on the topic, compare it - do not assume it matches

SEMANTIC COMPARISON (critical):
- Reduce statements to core meaning before comparing
- INCLUDE vs EXCLUDE are opposites - this is a contradiction
- REQUIRED vs OPTIONAL are opposites - this is a contradiction
- Different wording with same meaning = match
- Same topic with opposite instruction = contradiction

PROTOCOL TIEBREAKER:
- Protocol is source of truth
- Generated matching Protocol = CORRECT
- Generated contradicting Protocol = CRITICAL

PROTOCOL CHECK FOR MISSING ITEMS:
- For EVERY item in missing_from_generated_sap, search Protocol
- If found in Protocol → in_protocol: "yes", classification: "missing_required"
- If NOT in Protocol → in_protocol: "no", classification: "acceptable_difference"
- This is for display purposes - does NOT affect rating

BLOCKING VALIDATION (must pass):
- Count elements in evaluation_table
- Count elements in missing_from_generated_sap
- Sum MUST equal elements_extracted
- If counts_match is false, output is INVALID - re-extract
- Every evaluation_table entry MUST have non-null generated_sap_text
- Every missing_from_generated_sap entry MUST have null generated_sap_search
- Every missing_from_generated_sap entry MUST have in_protocol field
