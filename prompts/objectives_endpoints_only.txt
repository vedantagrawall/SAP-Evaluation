# Objectives and Endpoints Evaluation Prompt

You are evaluating a Generated SAP against an Original SAP for a clinical trial.

---

## DOCUMENTS PROVIDED

- **ORIGINAL SAP**: Human-written reference SAP
- **GENERATED SAP**: Auto-generated SAP being evaluated
- **PROTOCOL**: Source of truth when discrepancies arise

---

## YOUR TASK

Verify that all objectives and endpoints from the Original SAP are listed in the Generated SAP. The evaluation checks for missing items, contradictions, and extra items.

**For objectives:** Extract each objective with its full description.
**For endpoints:** Extract each endpoint with only its parameter description (one-liner). Do not extract definition details, analysis methods, or any other information about the endpoint.

---

## EVALUATION APPROACH

### PHASE 1: EXTRACTION

Extract all objectives and endpoints from ALL THREE documents:

1. Read the ENTIRE **Original SAP** and extract all objectives and endpoints.
2. Read the ENTIRE **Generated SAP** and extract all objectives and endpoints.
3. Read the ENTIRE **Protocol** and extract all objectives and endpoints.

For each objective, extract the full statement. For each endpoint, extract only the endpoint name and its parameter description. Each objective is one element. Each endpoint is one element.

### PHASE 2: COMPARISON

Using the three extracted lists, evaluate the Generated SAP:

**Missing items:** Any objective or endpoint present in the Original SAP but absent from the Generated SAP.
- If also present in Protocol → classification = `missing_required`
- If only in Original SAP (not in Protocol) → classification = `acceptable_difference`

**Contradictions:** Any objective or endpoint in the Generated SAP that contradicts the Original SAP or Protocol.

**Extra items:** Any objective or endpoint in the Generated SAP that is not present in the Original SAP.
- If also present in Protocol → neutral (not a problem)
- If contradicts Original SAP or Protocol → problem

### PHASE 3: VERIFICATION

Verify that all items from all three extraction lists have been accounted for in the comparison.

---

## RATING CRITERIA

### GREAT
- All objectives and endpoints from Original SAP are listed in Generated SAP
- No contradictions
- No missing required items

### DECENT
- All required objectives and endpoints present
- Minor wording differences

### POOR
- Required objectives or endpoints missing
- Contradictions found

**RATING RULE**: If ANY item has `classification: "missing_required"`, the rating MUST be POOR. If ANY contradiction is found, the rating MUST be POOR.

---

## OUTPUT FORMAT

Provide BOTH markdown (for human review) AND JSON (for programmatic use).

---

## JSON OUTPUT

```json
{
  "section": "objectives_endpoints",
  "rating": "GREAT | DECENT | POOR",
  "status": "pass | pass_with_notes | fail",

  "extraction": {
    "original_sap": [
      {"component": "short description", "type": "objective | endpoint", "text": "exact quote"}
    ],
    "generated_sap": [
      {"component": "short description", "type": "objective | endpoint", "text": "exact quote"}
    ],
    "protocol": [
      {"component": "short description", "type": "objective | endpoint", "text": "exact quote"}
    ]
  },

  "evaluation_table": [
    {
      "component": "short description",
      "type": "objective | endpoint",
      "original_sap_text": "exact quote",
      "generated_sap_text": "exact quote",
      "protocol_text": "exact quote or null",
      "matches_original_sap": "yes | no",
      "result": "correct | acceptable | problem",
      "reasoning": "Chain-of-thought explanation"
    }
  ],

  "missing_from_generated_sap": [
    {
      "component": "short description",
      "type": "objective | endpoint",
      "original_sap_text": "exact quote",
      "protocol_text": "exact quote if found, null if not",
      "in_protocol": "yes | no",
      "classification": "missing_required | acceptable_difference",
      "reasoning": "Chain-of-thought explanation"
    }
  ],

  "contradictions": [
    {
      "component": "short description",
      "type": "objective | endpoint",
      "original_sap_text": "exact quote",
      "generated_sap_text": "exact quote",
      "protocol_text": "exact quote or null",
      "description": "explanation of the contradiction",
      "reasoning": "Chain-of-thought explanation"
    }
  ],

  "extra_in_generated_sap": [
    {
      "component": "short description",
      "type": "objective | endpoint",
      "generated_sap_text": "exact quote",
      "in_protocol": "yes | no",
      "contradicts": "yes | no",
      "reasoning": "Chain-of-thought explanation"
    }
  ],

  "reasoning": "Step-by-step chain-of-thought reasoning trace",
  "summary": "2-3 sentence overall assessment"
}
```

---

## BLOCKING VALIDATION

Before finalizing output, verify that every item extracted from all three documents in Phase 1 is accounted for in the Phase 2 output arrays.
